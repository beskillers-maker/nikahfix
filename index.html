<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        /* Admin Section Styles */
        .admin-login { display:none; padding: 20px; text-align: center; background: #fff; margin-top: 20px; border-radius: 10px; }
        .admin-btn { background: #333; color: #fff; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .approve-btn { background: var(--green); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 5px; }
        .delete-btn { background: red; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 5px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo" onclick="checkAdmin()">Nikah<span>Fix</span></div>
        <button class="reg-btn" onclick="openModal()">Register Free</button>
    </nav>

    <main class="container">
        <div id="adminPanel" style="display:none; background: #ffe4e1; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h2 style="color:red">Admin Panel: Pending Approvals</h2>
            <ul id="pendingUsers" class="profile-grid"></ul>
            <button class="admin-btn" onclick="logoutAdmin()">Logout Admin</button>
        </div>

        <h2 id="liveTitle">Live Profiles</h2>
        <ul id="users" class="profile-grid"></ul>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCtKxg4q4zE7WfXdvDzEd4cpBfJMFzwKrQ",
            authDomain: "nikahfix-a6980.firebaseapp.com",
            projectId: "nikahfix-a6980",
            databaseURL: "https://nikahfix-a6980-default-rtdb.firebaseio.com",
            storageBucket: "nikahfix-a6980.firebasestorage.app",
            messagingSenderId: "742799659285",
            appId: "1:742799659285:web:dc111dc24654ac2c71991c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const usersRef = ref(db, 'profiles');

        // Form Submit (Ab status 'pending' jayega)
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // ... (Purana reader code) ...
            reader.onload = function(event) {
                const newUser = {
                    // ... (Purani fieldss) ...
                    status: "pending" // Naya Profile approval ka intezar karega
                };
                push(usersRef, newUser).then(() => {
                    alert("Profile submitted! Admin approval ke baad live hogi.");
                    closeModal();
                });
            };
        });

        // Data Load aur Display
        onValue(usersRef, (snapshot) => {
            const liveList = document.getElementById('users');
            const pendingList = document.getElementById('pendingUsers');
            liveList.innerHTML = "";
            pendingList.innerHTML = "";
            
            const data = snapshot.val();
            if (data) {
                Object.keys(data).reverse().forEach(key => {
                    const u = data[key];
                    const cardHTML = `
                        <li class="user-card" id="card-${key}">
                            <img src="${u.img}">
                            <div class="user-info">
                                <h3>${u.name}</h3>
                                <p>${u.city} | ${u.caste}</p>
                                ${u.status === 'pending' ? 
                                    `<button class="approve-btn" onclick="approveUser('${key}')">Approve</button>
                                     <button class="delete-btn" onclick="deleteUser('${key}')">Delete</button>` : 
                                    `<a href="https://wa.me/${u.wa}" class="wa-btn">WhatsApp</a>`}
                            </div>
                        </li>`;
                    
                    if(u.status === 'approved') {
                        liveList.innerHTML += cardHTML;
                    } else if (localStorage.getItem('isAdmin') === 'true') {
                        pendingList.innerHTML += cardHTML;
                    }
                });
            }
        });

        // Approval Functions
        window.approveUser = (id) => {
            update(ref(db, 'profiles/' + id), { status: 'approved' });
        };
        window.deleteUser = (id) => {
            if(confirm("Delete kar dein?")) remove(ref(db, 'profiles/' + id));
        };
    </script>

    <script>
        // Admin Login Logic
        function checkAdmin() {
            let pass = prompt("Admin Password daalein:");
            if(pass === "nikah786") { // Aap apna password yahan badal sakte hain
                localStorage.setItem('isAdmin', 'true');
                document.getElementById('adminPanel').style.display = "block";
                location.reload();
            }
        }
        if(localStorage.getItem('isAdmin') === 'true') {
            document.getElementById('adminPanel').style.display = "block";
        }
        function logoutAdmin() {
            localStorage.removeItem('isAdmin');
            location.reload();
        }
    </script>
</body>
</html>
